# 网络层

标签： ComputerNetworks

---

<!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 -->

- [网络层](#网络层)   
- [== [ IP ] ==](#ip)   
   - [Unreliable & Connectionless](#unreliable-connectionless)   
   - [IP地址](#ip地址)   
      - [五类IP地址](#五类ip地址)   
         - [三类IP地址](#三类ip地址)   
         - [特殊 IP 地址](#特殊-ip-地址)   
   - [封装过程](#封装过程)   
   - [IP路由选择](#ip路由选择)   
      - [== [ 路由表 ] ==](#路由表)   
- [== [ ARP | RARP ] ==](#arp-rarp)   
- [== [ 无连接服务 | 数据报网络 Datagram network] ==](#无连接服务-数据报网络-datagram-network)   
- [== [ 有连接服务 | 虚电路网络 Virtual-circuit network ] ==](#有连接服务-虚电路网络-virtual-circuit-network)   
- [== [ 拥塞控制算法 Congestion ] ==](#拥塞控制算法-congestion)   
   - [准入控制 - 虚电路网络](#准入控制-虚电路网络)   
   - [流量调节](#流量调节)   

<!-- /MDTOC -->

---
# == [ IP ] ==

## Unreliable & Connectionless

## IP地址
32位,通常用"点分十进制表示法(Dotted Decimal Notation)

### 五类IP地址

```
0     + 网 络 号 + 主     机     号 | 0.0.0.0 - 127.255.255.255
          7位             24位

10    + 网 络 号 + 主     机     号 | 128.0.0.0 - 191.255.255.255
          14位            16位

110   + 网 络 号 + 主     机     号 | 224.0.0.0 - 223.255.255.255
          21位            8位

1110  + 多       播       组       号 |224 - 239
                    28 位

11110 + 留       待       后       用 |240 - 247
                    27 位
```

让我们看看这几个数怎么来的

A类 $(0)_2$ + 7位网络号
`00000000 - 01111111 - 24位主机号`
0 - 127

B类 $(10)_2$ + 14位网络号
`10000000 00000000 - 10111111 1111111 - 16位主机号`
128 - 191

C类 $(110)_2$ + 21位网络号
`11000000 00000000 00000000 - 11011111 11111111 11111111 - 8位主机号`
192 - 223

D类 $(1110)_2$ + 28位多播组号
`11100000 00000000 00000000 00000000 - 11101111 11111111 11111111 11111111`
224 - 239

E类 $(11110)_2$ + 27位
`11110000 00000000 00000000 00000000 - 11110111 11111111 11111111 11111111`
240 - 247

所以区分一个IP的级别看第一个十进制数就行了

* 多接口主机具有多个IP地址, 其中每个接口都对应一个IP地址

#### 三类IP地址


+ 单播地址
目的为单个主机
要发送和接收单播分组，IP 分组报头中必须有一个目标 IP 地址，而以太网帧报头中必须有相应的目标 MAC 地址。IP 地址和 MAC 地址一起将数据传输到特定的目标主机。
+ 广播地址
目的端为给定网络上的所有主机
+ 多播地址
目的端为同一组内的所有主机

#### 特殊 IP 地址

## 封装过程
```
                        应用层数据
                            ↓
                          协议栈
                           TCP
                            ↓ TCP segment
                           IP
                            ↓ IP datagram
                        网络链路层
                            ↓ Frame
```
## IP路由选择
原理说起来很简单:

如果目的主机与源主机直接相连(如点对点链路),
或者在一个共享网络上(以太网或者令牌环网),
IP数据报直接送到目的主机上

否则主机把数据报发送到一默认路由上, 由路由器来转发该数据报

IP层既可以配置成路由器的功能, 也可以配置成主机的功能。
在一般的体制中,
IP可以从TCP, UDP, ICMP 和 IGMP 接收数据报并进行发送。__本地生成__
也可以 从一个网络接口接收数据报 __转发__

IP层在内存中有一个路由表。当收到一份数据报并进行发送时,它都要对该表搜索一次。
- 当数据报来自某个网络接口时, IP首先检查目的IP地址是否为本机的IP地址之一或者IP广播地址。
    - 如果是, 数据报就被送到IP首部协议字段指定的协议模块进行处理
- 如果不是, 那么
    - 如果IP层被设置为路由器的功能, 那么对此数据报进行转发,
    - 否则舍弃这个数据报
### == [ 路由表 ] ==
- __目的IP地址__, 既可以是一个完整的主机地址, 也可以是一个网络地址。
    由该表目中的标志字段来指定。
    一个完整非0的主机号用于指定某一特定主机
    网络地址的主机号是全0, 以指定网络中的所有主机
- __下一站路由器的IP地址__ 下一站路由器指在一个直接相连网络上的路由器,通过它可以转发数据报
- __标志__
    - 标志1 标明IP地址是主机地址还是网络地址
    - 标志2 标明下一站路由器是否为真正的
-
# == [ ARP | RARP ] ==
__一种说法是认为ARP在TCP/IP中属于网络层, 在 OSI 中属于链路层__

# == [ 无连接服务 | 数据报网络 Datagram network] ==
![datagram_network](/assets/datagram_network.png)
假设从H2传输一个消息到H1:
在OS里,为消息加上一个传输头, 将结果交给网络层
(我们假设这个例子中消息长度是最长数据包长度的4倍)
网络层将这些消息拆分成4个数据包: 1,2,3,4
然后使用某种点到点协议(比如PPP)将这些数据报依次发送到路由器A

# == [ 有连接服务 | 虚电路网络 Virtual-circuit network ] ==

# == [ 拥塞控制算法 Congestion ] ==
__需要网络层和传输层共同努力协调工作__
## 准入控制 - 虚电路网络
基本思想很简单:
除非网络可以携带额外的流量而不会变得拥塞, 否则不再建立新的虚电路

使用流量说明来进行准入控制
## 流量调节
在拥塞发生迫在眉睫时, 告诉发送方放慢传输速度
